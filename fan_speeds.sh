#!/usr/bin/env bash

# Set fan speeds of DELL r* servers

SERVER=$1
USER=$2
PW=$3
COMMAND=$4

declare -A commands
commands[set_manual]='0x30 0x30 0x01 0x00'
commands[set_auto]='0x30 0x30 0x01 0x01'
commands[20]='0x30 0x30 0x02 0xff 0x14'
commands[25]='0x30 0x30 0x02 0xff 0x19'
commands[30]='0x30 0x30 0x02 0xff 0x1e'
commands[35]='0x30 0x30 0x02 0xff 0x23'
commands[40]='0x30 0x30 0x02 0xff 0x28'
commands[45]='0x30 0x30 0x02 0xff 0x2D'
commands[50]='0x30 0x30 0x02 0xff 0x32'

case $COMMAND in
  20|25|30|35|40|45|50 )
    ipmitool -I lanplus -H $SERVER -U $USER -P $PW raw ${commands[set_manual]}
    ;;
  * )
  ;;
esac

echo ipmitool -I lanplus -H $SERVER -U $USER -P $PW raw ${commands[$COMMAND]}
ipmitool -I lanplus -H $SERVER -U $USER -P $PW raw ${commands[$COMMAND]}





